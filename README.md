# **AI DevSecOps Guardian**
<p align="center">
  <img src= "https://github.com/Jatin2567/AI-DevSecOps-Guardian/blob/main/assets/logo.png" alt="AI DevSecOps Guardian Logo" width="200"/>
</p>
AI-DevSecOps Guardian is an intelligence layer for GitLab CI/CD that provides:

- Automated AI-driven job failure diagnosis
- Keyword-based risk detection on successful jobs
- Built-in DevSecOps security controls

AI-powered observability, governance, and automated remediation framework for **GitLab CI/CD pipelines**.  
This system functions as an autonomous sentinel â€” monitoring build failures, diagnosing root causes, enforcing security policies, and generating actionable insights without developer intervention.

---

## ğŸš€ Overview

AI DevSecOps Guardian integrates directly with GitLab through webhook events. It streamlines pipeline governance by:

- Monitoring every pipeline and job event  
- Detecting failures, anomalies, and deviations  
- Automatically invoking AI to explain issues, recommend corrective actions, and support teams in real time  
- Ensuring enhanced compliance, operational discipline, and faster resolution cycles  

This leads to predictable delivery outcomes, enterprise-grade auditability, and measurable productivity uplift â€” essential for high-velocity engineering environments.

---

## âœ¨ Key Features

### **1. Automated Failure Diagnostics**
- Listens to job and pipeline webhooks  
- When a job fails, the Guardian triggers an AI-driven root-cause analysis  
- Provides remediation steps, context-specific insights, and recommended next actions  

### **2. Smart Job Trace Retrieval**
- Retrieves job trace logs securely via the GitLab API  
- Automatically handles pipeline structure, job hierarchy, and event parsing  

### **3. DevSecOps Controls**
- Webhook token validation  
- Secret masking and trace sanitization  
- Audit logs
- Least privilege GitLab token usage  

---

## ğŸ§© System Architecture

### **Core Components**

- **Webhook Receiver (Node.js/Express)** â€” Captures GitLab events  
- **Job Trace Manager** â€” Retrieves logs for failed jobs  
- **AI Engine Connector** â€” Submits logs + metadata for diagnostic processing  
- **Policy Engine** â€” Executes static and dynamic evaluation  
- **Audit Logger** â€” Stores all events, decisions, and AI insights  

---

## ğŸ“ Project Structure
```txt
AIDevSecOps-Guardian/
â”œâ”€â”€ debug/                  # will come after the code gets in runtime (logs information)
â”œâ”€â”€ node_modules/
â”‚â”€â”€assets/
â”‚  â””â”€â”€logo.png
â”‚
â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ db/
â”‚ â”‚ â””â”€â”€ fingerprintStore.js
â”‚ â”‚
â”‚ â”œâ”€â”€ routes/
â”‚ â”‚ â””â”€â”€ webhook.js
â”‚ â”‚
â”‚ â”œâ”€â”€ services/
â”‚ â”‚ â”œâ”€â”€ aiService.js
â”‚ â”‚ â”œâ”€â”€ debugStore.js
â”‚ â”‚ â”œâ”€â”€ detectorService.js
â”‚ â”‚ â”œâ”€â”€ gitlabService.js
â”‚ â”‚ â””â”€â”€ issueService.js
â”‚ â”‚
â”‚ â”œâ”€â”€ tests/
â”‚ â”‚ â”œâ”€â”€ gemini1.test.js
â”‚ â”‚ â”œâ”€â”€ issueService.test.js
â”‚ â”‚ â””â”€â”€ logParser.test.js
â”‚ â”‚
â”‚ â””â”€â”€ utils/
â”‚ â”œâ”€â”€ aiHelpers.js
â”‚ â”œâ”€â”€ fetchWithRetries.js
â”‚ â””â”€â”€ logParser.js
â”‚
â”œâ”€â”€ .env
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .gitignore    
â”œâ”€â”€ .nvmrc
â”‚
â”œâ”€â”€ LICENSE
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ server.js
```
---

## ğŸ” Prerequisites

- GitLab Project with Access  
- Webhooks enabled  
- Personal Access Token with API scope  
- Node.js 18+  
- Valid OpenAI / LLM API Key  

---

## âš™ï¸ Environment Setup

### Create a `.env` file
```txt
PORT=3000  
GITLAB_BASE_URL= <https://gitlab.com/api/v4 or any other if self hosted> 
GITLAB_TOKEN=<your_personal_access_token> 
GITLAB_API_URL = <api_url>
GITLAB_WEBHOOK_SECRET = <secret>
MONITORED_JOB_NAMES= <job_names>
MONITORED_STAGES= <job_stages>
FP_DB_DIR = <desired_location>
FP_DB_FILE = <desired_file_name>
MIN_CONF_CREATE = <desired_value>
AI_API_KEY= <api_key>
AI_MODEL= <desired_model>
AI_MAX_RETRIES= <desired_value>
AI_TIMEOUT_MS= <desired_value>
```
### Install dependencies

npm install

### Run the server

node server.js

---

## ğŸŒ GitLab Webhook Configuration

1. Go to Project Settings â†’ Webhooks  
2. Add your server endpoint:  
   https://<your-server-url>/webhook  
3. Select events:  
   - Pipeline events  
   - Job events  
4. Save.

---

## ğŸ§  How the AI Flow Works

1. GitLab triggers webhook for pipeline/job events  
2. If a job fails, Guardian fetches the job trace  
3. AI engine analyzes:  
   - Failure cause  
   - Error classification  
   - Suggested solutions  
   - Policy violations  
4. Guardian returns:  
   - Actionable summary  
   - Recommended fixes  
   - Logs stored in the Audit Trail  

---

## ğŸ“Š Example Insight Generated by the AI

**Root Cause:**  
Docker-in-Docker version mismatch triggered daemon startup failure.

**Recommended Remediation:**  
- Align DIND service and docker image versions  
- Add explicit version tags to prevent regressions  

**Sample Fix:**

image: docker:23.0  
services:  
  - docker:23.0-dind

---

## ğŸ“˜ Workflow Summary 

### Pipeline Event Handling

GitLab triggers a webhook whenever a pipeline or job is updated.  
The backend receives the payload and extracts the following fields:

- `projectId`
- `pipelineId`
- `jobId`
- `jobStatus`
- `stage`
- `jobName`

---

#### 1. Smart Event Filtering

- Events that are not job-related are discarded.  
- If `jobId` is missing, the system logs the event and ignores it (no AI invocation).

---

#### 2. Job Trace Retrieval

- The backend retrieves the job trace via the GitLab API.  
- If the trace cannot be fetched, the failure is logged and processing is halted.

---

#### 3. Dual-Path Processing Logic

##### **A. Failure Path â€” Job Failed**

Triggered when:

- `jobStatus == "failed"`

Actions:

- AI engine is invoked **once per failed job**.  
- System sends job trace + metadata for full RCA:
  - Root cause  
  - Failure classification  
  - Actionable remediation  
- A GitLab Issue is automatically **created or updated** based on findings.

---

##### **B. Success Keyword Path â€” Job Succeeded but Trace Contains Signals**

Triggered when:

- `jobStatus == "success"` **AND**  
- Job trace contains policy/quality/security indicators  
  (e.g., `"warning"`, `"deprecated"`, `"license risk"`)

Actions:

- AI performs a lightweight analysis (no full RCA).  
- Identifies risks, quality gaps, or soft violations detected **despite success**.  
- System may add a **non-blocking GitLab Issue or Comment** when relevant.

---

#### 4. Audit Logging & Governance

- Every action and AI decision is recorded in the audit trail.  
- All outputs, remediations, and escalations remain fully traceable.  

---
#### Flowchart :
```txt
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚      GitLab CI/CD      â”‚
                   â”‚ (Pipeline/Job Events)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Webhook Receiver   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Validate Event
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   Smart Event Filter        â”‚
                 â”‚ (Ignore non-job / no jobId) â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Fetch Job Trace (API)    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚     Decision Logic (Two Parallel Paths)     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Failure Path â”‚                                 â”‚ Success Keyword Path    â”‚
â”‚ (job failed)  â”‚                                 â”‚ (job success + keyword) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ AI call                                                â”‚ AI call 
       â–¼                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deep RCA + Fixes  â”‚                        â”‚  Warnings / Risks Note â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                               â”‚
          â–¼                                               â–¼
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         
                                â–¼                      
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Creates/Updates â”‚ 
                        â”‚ Gitlab Issue    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```


---

## ğŸ† Why This Project Stands Out

- Enterprise-grade automation typically seen in advanced DevSecOps suites 
- Significant reduction in MTTR  (mean time to recovery)
- Boosts developer throughput by eliminating manual debugging  
- Demonstrates strong synergy of AI, DevOps, and Security  

---

## ğŸ“œ License

MIT License.
